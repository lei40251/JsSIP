<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="PRTC.Logger.html">Logger</a><ul class='methods'><li data-type='method'><a href="PRTC.Logger.html#.setLogLevel">setLogLevel</a></li><li data-type='method'><a href="PRTC.Logger.html#.enableUploadLog">enableUploadLog</a></li><li data-type='method'><a href="PRTC.Logger.html#.disableUploadLog">disableUploadLog</a></li></ul></li><li><a href="PRTC.html">PRTC</a><ul class='members'><li data-type='member'><a href="PRTC.html#.version">version</a></li></ul><ul class='methods'><li data-type='method'><a href="PRTC.html#.checkSystemRequirements">checkSystemRequirements</a></li><li data-type='method'><a href="PRTC.html#.isScreenShareSupported">isScreenShareSupported</a></li><li data-type='method'><a href="PRTC.html#.getDevices">getDevices</a></li><li data-type='method'><a href="PRTC.html#.getCameras">getCameras</a></li><li data-type='method'><a href="PRTC.html#.getMicrophones">getMicrophones</a></li><li data-type='method'><a href="PRTC.html#.getSpeakers">getSpeakers</a></li><li data-type='method'><a href="PRTC.html#.createClient">createClient</a></li><li data-type='method'><a href="PRTC.html#.createStream">createStream</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="Client.html">Client</a><ul class='methods'><li data-type='method'><a href="Client.html#join">join</a></li><li data-type='method'><a href="Client.html#leave">leave</a></li><li data-type='method'><a href="Client.html#on">on</a></li><li data-type='method'><a href="Client.html#off">off</a></li></ul></li><li><a href="LocalStream.html">LocalStream</a><ul class='members'><li data-type='member'><a href="LocalStream.html#.userId">userId</a></li></ul><ul class='methods'><li data-type='method'><a href="LocalStream.html#initialize">initialize</a></li><li data-type='method'><a href="LocalStream.html#setAudioProfile">setAudioProfile</a></li><li data-type='method'><a href="LocalStream.html#setVideoProfile">setVideoProfile</a></li><li data-type='method'><a href="LocalStream.html#setVideoContentHint">setVideoContentHint</a></li><li data-type='method'><a href="LocalStream.html#close">close</a></li><li data-type='method'><a href="LocalStream.html#switchDevice">switchDevice</a></li><li data-type='method'><a href="LocalStream.html#muteVideo">muteVideo</a></li><li data-type='method'><a href="LocalStream.html#unmuteVideo">unmuteVideo</a></li><li data-type='method'><a href="LocalStream.html#muteAudio">muteAudio</a></li><li data-type='method'><a href="LocalStream.html#unmuteAudio">unmuteAudio</a></li></ul></li><li><a href="RemoteStream.html">RemoteStream</a><ul class='members'><li data-type='member'><a href="RemoteStream.html#.type">type</a></li><li data-type='member'><a href="RemoteStream.html#.userId">userId</a></li><li data-type='member'><a href="RemoteStream.html#.display_name">display_name</a></li></ul><ul class='methods'><li data-type='method'><a href="RemoteStream.html#muteVideo">muteVideo</a></li><li data-type='method'><a href="RemoteStream.html#unmuteVideo">unmuteVideo</a></li><li data-type='method'><a href="RemoteStream.html#muteAudio">muteAudio</a></li><li data-type='method'><a href="RemoteStream.html#unmuteAudio">unmuteAudio</a></li></ul></li><li><a href="Stream.html">Stream</a><ul class='members'><li data-type='member'><a href="Stream.html#.id">id</a></li><li data-type='member'><a href="Stream.html#.stream">stream</a></li></ul><ul class='methods'><li data-type='method'><a href="Stream.html#muteVideo">muteVideo</a></li><li data-type='method'><a href="Stream.html#unmuteVideo">unmuteVideo</a></li><li data-type='method'><a href="Stream.html#muteAudio">muteAudio</a></li><li data-type='method'><a href="Stream.html#unmuteAudio">unmuteAudio</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="Client.html#event:JOIN-ROOM-FAILED">JOIN-ROOM-FAILED</a></li><li><a href="Client.html#event:CONNECTION-STATE-CHANGED">CONNECTION-STATE-CHANGED</a></li><li><a href="Client.html#event:REGISTRATIONFAILED">REGISTRATIONFAILED</a></li><li><a href="Client.html#event:REGISTERED">REGISTERED</a></li><li><a href="Client.html#event:ERROR">ERROR</a></li><li><a href="Client.html#event:LOCAL-JOINED">LOCAL-JOINED</a></li><li><a href="Client.html#event:LOCAL-LEAVE">LOCAL-LEAVE</a></li><li><a href="Client.html#event:STREAM-ADDED">STREAM-ADDED</a></li><li><a href="Client.html#event:PEER-JOIN">PEER-JOIN</a></li><li><a href="Client.html#event:STREAM-REMOVED">STREAM-REMOVED</a></li><li><a href="Client.html#event:PEER-LEAVE">PEER-LEAVE</a></li><li><a href="LocalStream.html#event:STOPPED">STOPPED</a></li><li><a href="LocalStream.html#event:CLOSE-FAILED">CLOSE-FAILED</a></li></ul><h3>Global</h3><ul><li><a href="global.html#VideoProfile">VideoProfile</a></li><li><a href="global.html#CheckResult">CheckResult</a></li></ul>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme usertext">
        <article><h1>PRTC Web SDK</h1>
<h2>Note</h2>
<p>请务必使用Https 协议 或者localhost 来部署您的Web App，否则会出现找不到 navigator.mediaDevices 错误！</p>
<h2>Online Demo</h2>
<ul>
<li><a href="https://pro.vsbc.com/rtc/demo/prtc/" title="PRTC Demo">PRTC Demo</a></li>
</ul>
<h2>Sample Code</h2>
<p>各基本功能示例</p>
<pre class="prettyprint source"><code>// 控制台输出SDK版本信息
console.log(PRTC.version);

// 会话路由地址，创建&加入会议用
const callRouterUrl = 'https://pro.vsbc.com/pa';

// 客户端对象
let client = null;
// 本端媒体对象
let localStream = null;
// 远端音频流对象
let remoteAudioStream = null;

// 本端视频流禁用状态
let localVideoMuted = false;
// 本端音频流禁用状态
let localAudioMuted = false;
// 远端音频流禁用状态
let remoteAudioMuted = false;

// 会议结束重置参数
function resetStatus()
{
  localStream = null;
  remoteAudioStream = null;

  localVideoMuted = false;
  localAudioMuted = false;
  remoteAudioMuted = false;

  document.querySelector('#rvs').innerHTML = '';
  document.querySelector('#local_stream').srcObject = null;
}

// 渲染远端媒体
function renderRemoteStream(remoteStream)
{
  // 远端视频div容器
  const rvsEle = document.querySelector('#rvs');

  const div = document.createElement('div');
  const p = document.createElement('p');
  const btn = document.createElement('button');

  div.classList = 'remote_stream';
  div.dataset.stream_id = remoteStream.id;

  btn.classList = 'handle_remote_stream';
  btn.innerText = '关闭视频';
  btn.dataset.muted = 0;
  // 远端视频上按钮的操作
  btn.onclick = function(self)
  {
    if (self.target.dataset.muted == '1')
    {
      if (stream.unmuteVideo() == '1')
      {
        self.target.innerHTML = '关闭视频';
        self.target.dataset.muted = '0';
      }
      else
      {
        console.warn('开启失败');
      }
    }
    else if (stream.muteVideo())
    {
      self.target.innerHTML = '开启视频';
      self.target.dataset.muted = '1';
    }
    else
    {
      console.warn('关闭失败');
    }
  };

  p.innerText = `${remoteStream.userId}(${remoteStream.display_name})`;

  const video =document.createElement('video');
  // 安卓微信浏览器用
  const x5VideoPlayerFullscreen = document.createAttribute('x5-video-player-fullscreen');
  const x5VideoPlayerType = document.createAttribute('x5-video-player-type');

  x5VideoPlayerFullscreen.value=true;
  x5VideoPlayerType.value='h5';

  // 设置video属性
  video.setAttributeNode(x5VideoPlayerType);
  video.setAttributeNode(x5VideoPlayerFullscreen);
  video.autoplay=true;
  video.playsInline =true;

  // 媒体流
  video.srcObject = remoteStream.stream;
  video.onclick = function()
  {
    captureVideo(video);
  };

  // 将video等 插入页面
  div.append(video);
  div.append(p);
  div.append(btn);
  rvsEle.append(div);
}

// 离会回调，方便监听和取消监听用
function peerLeave(data)
{
  console.log('远端用户离开会议: ', data.userId);
}

// 客户端初始化
function initSignalling()
{
  // clientConfig 配置项
  const configuration = {
    call_router_url : callRouterUrl,
    sdk_app_id      : sdkAppId,
    user_id         : userId,
    user_sig        : userSig
  };

  // 创建 client
  client = PRTC.createClient(configuration);

  // 信令连接成功建立
  client.on('connection-state-changed', function(data)
  {
    console.log('connection-state-changed: ', data);
  });

  // 注册成功，在需要注册场景可用
  client.on('peer-join', function(e)
  {
    console.log('远端用户加入: ', e.userId);
  });

  // 注册失败，在需要注册场景可用
  client.on('peer-leave', peerLeave);

  // 已添加远端流
  client.on('stream-added', function(remoteStream)
  {
    // 远端音频混流，此处单独处理远端音频
    if (remoteStream.type === 'audio')
    {
      remoteAudioStream = remoteStream;
      const audioPlayer = document.createElement('audio');

      audioPlayer.srcObject = remoteStream.stream;
      audioPlayer.play();
    }
    else
    {
      renderRemoteStream(remoteStream);
    }
  });

  // 已删除远端流
  client.on('stream-removed', function(remoteStream)
  {
    const remoteStreamDivs = document.querySelectorAll('.remote_stream');

    remoteStreamDivs.forEach(function(div)
    {
      if (div.dataset.stream_id === remoteStream.id)
      {
        div.remove();
      }
    });
  });

  // 本端加入会议
  client.on('local-joined', function(data)
  {
    console.log('您已加入会议');
    localStream = data;

    localStream.stream.oninactive= () =>
    {
      console.log('Video stopped either because 1) it was over, ' +
          'or 2) no further data is available.');
    };

    localStream.custom || (document.querySelector('#local_stream').srcObject = localStream.stream);
  });

  // 本端离开会议
  client.on('local-left', function()
  {
    resetStatus();
    console.log('您已离开会议');
  });

  // 客户端错误事件处理
  client.on('error', function(data)
  {
    console.log('error: ', data);
  });
}

// 启动
function start()
{
  getTemper(initSignalling);
}

start();

// 分享桌面
document.querySelector('#screenShare').onclick=function()
{
  client.displayShare();
};

// 预览本端媒体
document.querySelector('#create_stream').onclick = function()
{
  localStream = new PRTC.LocalStream({});

  localStream.on('stop', () =>
  {
    console.log('localstream is stopped.');
  });

  localStream.initialize().then(function()
  {
    document.querySelector('#local_stream').srcObject = localStream.stream;
  });
};

// 加入会议
document.querySelector('#join_conf').onclick =function()
{
  if (localStream)
  {
    client.join(document.querySelector('#roomId').value, document.querySelector('#display_name').value, { mediaStream: localStream.stream });
  }
  else
  {
    client.join(document.querySelector('#roomId').value, document.querySelector('#display_name').value);
  }
};

// 离开会议
document.querySelector('#leave').onclick =function()
{
  client.off('peer-leave', peerLeave);
  client.leave();
};

// 切换本端视频状态
document.querySelector('#handle_local_video').onclick = function(self)
{
  if (localVideoMuted)
  {
    if (localStream.unmuteVideo())
    {
      self.target.innerHTML = '禁用本端视频';
      localVideoMuted = !localVideoMuted;
    }
    else
    {
      console.warn('启用失败');
    }
  }
  else if (localStream.muteVideo())
  {
    self.target.innerHTML = '启用本端视频';
    localVideoMuted = !localVideoMuted;
  }
  else
  {
    console.warn('禁用失败');
  }
};

// 切换本端音频状态
document.querySelector('#handle_local_audio').onclick = function(self)
{
  if (localAudioMuted)
  {
    if (localStream.unmuteAudio())
    {
      self.target.innerHTML = '禁用本端音频';
      localAudioMuted = !localAudioMuted;
    }
    else
    {
      console.warn('启用失败');
    }
  }
  else if (localStream.muteAudio())
  {
    self.target.innerHTML = '启用本端音频';
    localAudioMuted = !localAudioMuted;
  }
  else
  {
    console.warn('禁用失败');
  }
};

// 切换远端音频状态
document.querySelector('#handle_remote_audio').onclick = function(self)
{
  if (remoteAudioMuted)
  {
    if (remoteAudioStream.unmuteAudio())
    {
      self.target.innerHTML = '禁用远端音频';
      remoteAudioMuted = !remoteAudioMuted;
    }
    else
    {
      console.warn('启用失败');
    }
  }
  else if (remoteAudioStream.muteAudio())
  {
    self.target.innerHTML = '启用远端音频';
    remoteAudioMuted = !remoteAudioMuted;
  }
  else
  {
    console.warn('禁用失败');
  }
};

// 切换摄像头
document.querySelector('#switch_device').onclick = function()
{
  localStream.switchDevice().then(function(s)
  {
    document.querySelector('#local_stream').srcObject = s;
  });
};
</code></pre></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Wed Nov 17 2021 09:55:51 GMT+0800 (中国标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



    <link type="text/css" rel="stylesheet" href="./styles/custom.css">
    
</body>
</html>